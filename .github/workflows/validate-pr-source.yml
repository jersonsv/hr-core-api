name: Validate PR Source

on:
  pull_request:
    branches: [ main ]  # Solo PRs hacia main
    types: [opened, synchronize, reopened]

jobs:
  validate-source:
    runs-on: ubuntu-latest
    name: Validate PR comes from develop
    # Condici√≥n adicional para asegurar que solo corra para PRs hacia main
    if: github.base_ref == 'main'
    steps:
    - name: Check PR source branch
      run: |
        echo "üîç Checking PR source branch..."
        echo "Source branch: ${{ github.head_ref }}"
        echo "Target branch: ${{ github.base_ref }}"
        echo "Event action: ${{ github.event.action }}"
        echo "Repository default branch: ${{ github.event.repository.default_branch }}"
        
        # Verificaci√≥n de seguridad - solo debe ejecutarse para PRs hacia main
        if [ "${{ github.base_ref }}" != "main" ]; then
          echo ""
          echo "‚ö†Ô∏è  WARNING: This workflow should only run for PRs targeting 'main' branch"
          echo "‚ö†Ô∏è  Current target branch: ${{ github.base_ref }}"
          echo "‚ö†Ô∏è  Skipping validation..."
          echo ""
          exit 0
        fi
        
        # Validaci√≥n principal: el PR hacia main debe venir desde develop
        if [ "${{ github.head_ref }}" != "develop" ]; then
          echo ""
          echo "‚ùå ERROR: Pull requests to main branch must come from develop branch only!"
          echo "‚ùå Current source branch: ${{ github.head_ref }}"
          echo "‚ùå Expected source branch: develop"
          echo ""
          echo "üîÑ Please:"
          echo "1. Close this PR"
          echo "2. Merge your changes to develop first"
          echo "3. Create a new PR from develop to main"
          echo ""
          exit 1
        else
          echo ""
          echo "‚úÖ SUCCESS: Pull request source validated!"
          echo "‚úÖ develop ‚Üí main is allowed"
          echo "‚úÖ This PR follows the correct GitFlow pattern"
          echo ""
        fi